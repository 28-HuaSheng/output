### åœºæ™¯åˆ†æ
- å•serviceä¸å¯ç”¨ï¼Œå¼•å‘çš„é›ªå´©
   - service-a è°ƒç”¨ service-bï¼Œservice-bè°ƒç”¨service-cï¼Œå¦‚æœservice-cä¸å¯ç”¨ï¼Œä¼šæ‰©æ•£è‡³æ•´ä¸ªé›†ç¾¤
   - service-c ä½œä¸ºprovider, å†…éƒ¨å°±æ˜¯rpcå½“æ—¶ é˜Ÿåˆ—-çº¿ç¨‹æ±  æ¨¡å‹å›¾ã€‚
- æŸä¸ªæœåŠ¡qpså¢åŠ è¿‡å¤š
   - service-a(æ¯ä¸ªå•ç‹¬çš„æœåŠ¡éƒ½å¯ä»¥è€ƒè™‘ä¸ºä¸€ä¸ªé›†ç¾¤) å’Œ service-b(é›†ç¾¤) éƒ½è°ƒç”¨service-c(é›†ç¾¤), æœ¬æ¥æŒ‰ç…§ä¼°ç®—service-cæä¾›5000qpsï¼Œservice-b qpsçªç„¶åŠ åˆ°å‡ w, é‚£service-cå¤„ç†ä¸è¿‡æ¥å°±ä¼šå †ç§¯ï¼Œaå¯¹cçš„è°ƒç”¨ä¹Ÿä¸å¯ä»¥è¿›è¡Œäº†ã€‚
### è§£å†³
#### ä¸€. èµ„æºéš”ç¦»
##### 1.èµ„æºéš”ç¦»-èˆ¹éš”èˆ±(è¿›ä¸€éƒ¨åˆ†æ°´,å¯¹æ•´ä½“ä¸å½±å“)

   1. ä¸»è¦å¯¹çº¿ç¨‹èµ„æºéš”ç¦»,çº¿ç¨‹æ± ã€‚ éœ€è¦æŒ‰ç…§è¯·æ±‚åˆ†å‰²å¼€ï¼Œå¦åˆ™ å¦‚ æŸ¥æ‰¾ç”¨æˆ·çš„è¯·æ±‚å¦‚æœæ…¢,è€Œä¸”æ²¡æœ‰éš”ç¦»åˆ†æ•£åœ¨å„ä¸ªçº¿ç¨‹æ± ï¼Œé‚£ä¹ˆå‡ºé—®é¢˜ä¹Ÿæ˜¯ç™½æ­ã€‚
   1. consume å’Œ provide éƒ½éœ€è¦è¿›è¡Œéš”ç¦»
   1. ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646490130538-b51d3f05-1a53-433e-88e0-24b518f04e95.png#clientId=u6b087f2a-eae8-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=249&id=u22db5df3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=498&originWidth=1260&originalType=binary&ratio=1&rotation=0&showTitle=false&size=128829&status=done&style=none&taskId=u57897d39-063b-4fd1-8b8e-2c48721cb97&title=&width=630)
   1. ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646490107437-70116c12-9855-4f8a-9d3d-09ee536ab217.png#clientId=u6b087f2a-eae8-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=237&id=u34e7bd1a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=474&originWidth=1256&originalType=binary&ratio=1&rotation=0&showTitle=false&size=112728&status=done&style=none&taskId=u597c15a9-d0f4-4fdc-9358-5e355ef000e&title=&width=628)
##### 2.ä¿¡å·é‡ æ§åˆ¶å¹¶å‘é‡
##### 3.çº¿ç¨‹éš”ç¦»å’Œä¿¡å·é‡å¯ä»¥å…±åŒä½¿ç”¨

   5. ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646490193229-b059d023-1f83-4ae2-a141-d14e703d07fc.png#clientId=u6b087f2a-eae8-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=388&id=ua8a412d6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=526&originWidth=722&originalType=binary&ratio=1&rotation=0&showTitle=false&size=161822&status=done&style=none&taskId=u3943234c-8ee8-4b8f-aacb-e12539336c9&title=&width=533)
   5. å¯¹æ¯”ï¼š
      1. ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646490231758-317117a7-95eb-43be-a508-e13f7e9c2905.png#clientId=u6b087f2a-eae8-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=112&id=u669a4beb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=224&originWidth=1090&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40924&status=done&style=none&taskId=u5fa8896e-ee38-40fe-8c15-1c061d3c264&title=&width=545)
      1. çº¿ç¨‹åˆ‡æ¢ï¼šä¸€ä¸ªå·¥ä½œçº¿ç¨‹ è½¬ åˆ†é…çš„çº¿ç¨‹æ±  ã€‚ä¸€ä¸ªç›´æ¥ä½¿ç”¨å·¥ä½œçº¿ç¨‹ï¼Œåªè¦æ‹¿åˆ°ä¿¡å·å°±ok
      1. å¼‚æ­¥ï¼šæ¢çº¿ç¨‹æ± äº†ï¼Œå·¥ä½œçº¿ç¨‹å¯ä»¥åšå…¶ä»–äº‹æƒ…
      1. è¶…æ—¶ï¼šçº¿ç¨‹æ± å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± çš„è¶…æ—¶ã€‚ä¿¡å·é‡è¿™é‡Œæ²¡æœ‰è¶…æ—¶ï¼Œä¾èµ–æ¡†æ¶æœ¬èº«çš„ï¼Œæˆ‘ä»¬ä¹‹å‰çš„æ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾rpc ä½¿ç”¨çš„è¶…æ—¶æ–¹æ¡ˆã€‚
#### äºŒ. ç†”æ–­
##### 1.åœºæ™¯

1. åŒåä¸€å…³é—­é€€æ¬¾
1. å…³é—­æ¢å¤´åƒ
1. è¾¾åˆ°æŸä¸€é˜€å€¼ï¼Œè‡ªåŠ¨è§¦å‘
##### 2.æ¶‰åŠ

1. å¯ç†”æ–­æœåŠ¡ - ç†”æ–­å“ªä¸ªæœåŠ¡ï¼Ÿ
1. ä¸»åŠ¨ è‡ªåŠ¨ è§¦å‘
1. æ¢å¤
##### 3.æ–­è·¯å™¨è®¾è®¡
###### a . æ–­è·¯å™¨æ§åˆ¶é€»è¾‘

   1. ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646566401294-d91b8c7c-5e59-4c2c-becc-4ec6ed9f4d1c.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=216&id=uaf091f23&margin=%5Bobject%20Object%5D&name=image.png&originHeight=432&originWidth=946&originalType=binary&ratio=1&rotation=0&showTitle=false&size=73460&status=done&style=none&taskId=ud760b72e-7ef6-428e-932b-eed862dcca7&title=&width=473)
###### b. æ–­è·¯å™¨é˜€å€¼å’Œç»Ÿè®¡æ•°æ®
å¤±è´¥è¾¾åˆ°ç™¾åˆ†æ¯”å¤šå°‘å¼€å§‹è§¦å‘ï¼šé‚£ä¹ˆæˆ‘ä¸€å¤©ä¸­å‰20å°æ—¶éƒ½æ˜¯æ­£å¸¸çš„ï¼Œåˆ°äº†20ç‚¹ æœ‰5åˆ†é’Ÿä¸å¯ç”¨ï¼Œä½†æ˜¯ç™¾åˆ†æ¯”è¿˜æ²¡è¾¾åˆ°ï¼Œé‚£ä¹ˆæˆ‘æ–­è·¯è§¦å‘ä¸äº†ã€‚ æˆ–è€…è®¾è®¡çš„ä¸å¯ç”¨è¯·æ±‚30%ï¼Œæ¯æ¬¡åˆ°äº†29%å¥½äº†ï¼Œé‚£ä¹ˆä¹Ÿè§¦å‘ä¸äº†ï¼Œä½†æ˜¯ä¸è§¦å‘åˆæ˜¯ä¸å¯¹çš„ã€‚

- æ•°æ®ç±»å‹ï¼šç™¾åˆ†æ¯”å€¼
- é¢—ç²’åº¦
   - é›†ç¾¤/èŠ‚ç‚¹
      - é›†ç¾¤ï¼šclient Cè°ƒç”¨ a,b,c,dï¼ŒaæœåŠ¡é›†ç¾¤æœ‰4ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨âŒçš„è¯ï¼Œå¯¹aæ¥è®²25%çš„ä¸å¯ç”¨ï¼Œé‚£ä¹ˆå‡ºå‘ç†”æ–­çš„è¯ï¼Œaè¿˜æœ‰ä¸‰å°æœºå™¨å¯ä»¥ä½¿ç”¨å‘¢ã€‚è¿™ç‚¹ä¸å‹å¥½
      - èŠ‚ç‚¹ï¼šæ¥ç€ä¸Šé¢çš„ï¼ŒaæœåŠ¡é›†ç¾¤æœ‰ 1ï¼Œ2ï¼Œ3ï¼Œ4ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ¯ä¸ªèŠ‚ç‚¹é‡Œé¢è¿˜æœ‰å¤šä¸ªserviceå‘¢ï¼Œæ¯ä¸ªserviceè¿˜æœ‰å¤šä¸ªæ–¹æ³•å‘¢ã€‚æŸä¸ªserviceä¸å¯ç”¨ï¼Œä¸ä»£è¡¨è¿™ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œæˆ–è€…æŸä¸ªæ–¹æ³•ä¸å¯ç”¨âŒï¼Œä¹Ÿä¸ä»£è¡¨æŸä¸ªserviceä¸å¯ç”¨
   - æœåŠ¡/æ–¹æ³•
      - æŒ‰ç…§æ–¹æ³•çš„é¢—ç²’åº¦æœ€ç»†
- æ•°æ®ç»“æ„ + ç»Ÿè®¡å•å…ƒ
   - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646571181735-320b26ef-eeec-4b41-9582-de09e480d815.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=176&id=u3cb18ce2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=352&originWidth=532&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35918&status=done&style=none&taskId=u7277880d-47f2-4366-b42f-418bc31b995&title=&width=266)
   - æˆåŠŸè¯·æ±‚æ¬¡æ•°ï¼Œå¤±è´¥è¯·æ±‚ä¸ªæ•°ï¼Œè¶…æ—¶ä¸ªæ•°ï¼Œå¼€å§‹ç»Ÿè®¡æ—¶é—´

###### c. æ–­è·¯å™¨é˜€å€¼å’Œç»Ÿè®¡æ•°æ®è®¾è®¡

- å‡å°‘è¯¯åˆ¤
   - ç»Ÿè®¡é—´éš”æ—¶é—´1sä¸€æ¬¡ï¼Œå¦‚æœç½‘ç»œ1sçš„æŠ–åŠ¨ï¼Œä¹Ÿè§¦å‘æ˜¾ç„¶ä¸åˆç†ï¼Œå¤ªé•¿çš„è¯ï¼Œ10åˆ†é’Ÿç»Ÿè®¡ä¸€æ¬¡ï¼Œä¼šå¯¼è‡´æ•°æ®é‡å¤ªå¤šï¼Œå³ä½¿æœ‰éƒ¨åˆ†ä¸å¯ç”¨ï¼Œä¹Ÿè§¦å‘ä¸äº†æ–­è·¯
- æ»‘åŠ¨çª—å£è®¾è®¡
   - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646579469310-7b92d2b2-1977-40e1-b679-3060d309317a.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=167&id=udb17df83&margin=%5Bobject%20Object%5D&name=image.png&originHeight=718&originWidth=1696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=134354&status=done&style=none&taskId=u8bcec5e7-f716-468d-94ea-71b28c493a5&title=&width=394)
   - æ¯”å¦‚5sä¸€ä¸ªbucket, ä¸€ä¸ªbucketå°±æ˜¯è¿™5så†…æ‰€æœ‰æ”¶åˆ°çš„è¯·æ±‚æ•°æ®ï¼Œæ¯æ–°å¼€ä¸€ä¸ªbucket, è§¦å‘ä¸€æ¬¡è®¡ç®—çœ‹éœ€ä¸éœ€è¦ç†”æ–­ã€‚ä¸å¯èƒ½æ¯æ–°æ¥ä¸€ä¸ªè¯·æ±‚å°±è®¡ç®—ä¸€æ¬¡ï¼Œé‚£æ ·å¤ªé¢‘ç¹äº†ã€‚
   - ä½†æ˜¯è®¡ç®—å¤šä¹…çš„æ•°æ®å‘¢ï¼Ÿéœ€è¦æ‘’å¼ƒä¸€äº›æ—§æ•°æ®ï¼Œæ¯”å¦‚æˆ‘æ¯æ¬¡éƒ½è®¡ç®—å‰10ä¸ªbucketçš„æ•°æ®ã€‚
   - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646580101171-8cd01a53-8f29-4f50-b11e-29eeafbe0348.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=99&id=uc120d92b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=384&originWidth=1586&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69300&status=done&style=none&taskId=ud0bce392-3eb0-4174-ba86-cd32b08991b&title=&width=408)
- æ•°æ®ç»“æ„é€‰æ‹©
   - é“¾è¡¨
   - å¾ªç¯æ•°ç»„ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ç§
- æ»‘åŠ¨çª—å£ä»£ç å®ç°
   - æ•°æ®ç»“æ„
      - Bucket
         - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646580819899-eb33db26-f3ae-4d62-851b-a5179925f282.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=99&id=uc2fca168&margin=%5Bobject%20Object%5D&name=image.png&originHeight=236&originWidth=586&originalType=binary&ratio=1&rotation=0&showTitle=false&size=73410&status=done&style=none&taskId=uaac14e30-5548-46dd-98a2-20c476f8dca&title=&width=247) å¼€å§‹æ—¶é—´/æˆåŠŸæ•°é‡/å¤±è´¥æ•°é‡/è¶…æ—¶æ—¶é—´
      - BucketCircularArray å¾ªç¯æ•°ç»„å°è£…ç±»
         - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646580937585-16fed9c7-3789-40cf-9ad8-9df4d3088b13.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=121&id=ub7ab972d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=242&originWidth=428&originalType=binary&ratio=1&rotation=0&showTitle=false&size=58002&status=done&style=none&taskId=uf426e8fd-b6b4-4468-9bf7-b8764cd648b&title=&width=214) æ•°ç»„é•¿åº¦/æœ‰æ•°æ®çš„é•¿åº¦/æ­£ç»çš„æ•°æ®/å¤´æŒ‡é’ˆ/å°¾æŒ‡é’ˆ
            - maxSize åˆå§‹åŒ–10ä¸ªé•¿åº¦ï¼Œå¦‚æœè§‰å¾—ç»Ÿè®¡ä¸ç²¾å‡†ï¼Œå¯ä»¥æ‰©å¤§ï¼Œä¸èƒ½è¶…è¿‡maxSizeã€‚
            - headåˆ°tailä¹‹é—´çš„æ•°æ® ç›¸å½“äºå°±æ˜¯æœ€æ–°çš„è¿™äº›æ•°æ®ï¼Œå¯ä»¥æƒ³è±¡ä¸€ä¸ªç¯ã€‚
            - å¦ä¸€ä¸ªçº¬åº¦å¯ä»¥æƒ³è±¡ï¼Œtailå°±æ˜¯å¾€åå¤´ä¸€ç›´å»¶é•¿ï¼Œheadä¹Ÿå¾€åç§»åŠ¨ï¼Œè¿™æ ·head-tailä¹‹é—´ä¹Ÿæ˜¯æ°¸è¿œæ˜¯ä¸€ä¸ªå®šé•¿ã€‚
         - æ–¹æ³•ï¼š
            - addBucket() æ–¹æ³•é‡Œè°ƒç”¨-> incrementTail()
               - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646581246453-967e4c25-1a91-42d3-b0ca-418b85726c5b.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=201&id=uaf1468da&margin=%5Bobject%20Object%5D&name=image.png&originHeight=618&originWidth=620&originalType=binary&ratio=1&rotation=0&showTitle=false&size=137264&status=done&style=none&taskId=ud9dd634d-21d7-4ed7-a314-7d72a6f8d66&title=&width=202)
               - æ–°å¢bucket ,  æ•°æ®æ²¡æ»¡çš„è¯ headæŒ‡é’ˆä¸ç”¨ç§»åŠ¨ tailç§»åŠ¨å°±å¯ä»¥ï¼Œæ•°æ®æ»¡çš„è¯ï¼ŒheadæŒ‡é’ˆä¹Ÿéœ€è¦ç§»åŠ¨ï¼Œheadå‰çš„æ•°æ®æ‘’å¼ƒã€‚
            - tail() - è·å–æœ€åä¸€ä¸ªæœ‰æ•°æ®çš„ä½ç½®çš„æ•°æ®,ä¹Ÿå°±æ˜¯tailæŒ‡é’ˆå‰ä¸€ä¸ªæ§½ï¼ˆæ¯ä¸€æ¬¡æ”¾æ–°bucketçš„åœ°æ–¹ï¼‰
            - toArray()  - æŠŠå°è£…çš„å¾ªç¯æ•°ç»„é‡Œæ‰€æœ‰ä¸ç©ºçš„bucketæ‹¿å‡ºæ¥ï¼Œæ±‡æ€»ï¼Œä»¥ä¾¿ä¹‹åè®¡ç®—éœ€ä¸éœ€è¦æ–­è·¯ã€‚
               - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646656609445-34b0c3c1-0893-45bc-a299-55f2fc3eb766.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=307&id=u6f6f6848&margin=%5Bobject%20Object%5D&name=image.png&originHeight=614&originWidth=750&originalType=binary&ratio=1&rotation=0&showTitle=false&size=149267&status=done&style=none&taskId=uea79e135-d345-4e5d-9545-a51cf28c516&title=&width=375)
   - æ–­è·¯å™¨è®¾è®¡ CircuitBreaker
      - tryMarkOpen -> closeå˜open ------å¼€å¯æ–­è·¯å™¨,åªèƒ½ä»closeå˜ä¸ºå¼€
         - ä¼ å…¥ç™¾åˆ†æ¯”å€¼ï¼Œæ–¹æ³•é‡ŒcompareAndSet,ç¡®ä¿close å˜ open
      - attempExecution -> openå˜halfOpen ---------è¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼ˆçª—å£æœŸï¼‰ï¼Œå°è¯•å˜ä¸ºåŠå¼€çŠ¶æ€
         - ä»£ç é‡Œåˆ¤æ–­æ—¶é—´ï¼Œåˆ°äº†å°±å¼€å¯åŠå¼€çŠ¶æ€
      - markSuccess -> halfOpenå˜close ---------- åŠå¼€çŠ¶æ€å°è¯•çœ‹èƒ½ä¸èƒ½è¯·æ±‚æˆåŠŸï¼Œç„¶åå…³é—­æ–­è·¯å™¨
         - compreAndSet
      - markSuccrss -> halfOpenå˜open ------åŠå¼€çŠ¶æ€è¯·æ±‚æ²¡æˆåŠŸï¼Œç»§ç»­ä¿æŒæ–­è·¯
         - compreAndSet
   - æ§åˆ¶å™¨ MetricTimeWindow
      - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646664821355-5d01d973-9588-4c2b-b463-9ea5791f7458.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=123&id=u83925902&margin=%5Bobject%20Object%5D&name=image.png&originHeight=246&originWidth=916&originalType=binary&ratio=1&rotation=0&showTitle=false&size=106682&status=done&style=none&taskId=uc1b96e0b-a6d9-46dd-98b5-707b27e90a1&title=&width=458)
         - æ„é€ å‡½æ•°ï¼šserviceï¼Œæ–¹æ³•ï¼Œç„¶åå°±æ˜¯ä¸Šé¢çš„å¾ªç¯æ•°ç»„ã€‚è¯´æ˜ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªæ»‘åŠ¨çª—å£æ¥æ§åˆ¶ï¼Œæ˜¯æ–¹æ³•çº§åˆ«çš„ã€‚
      - addEventæ–¹æ³•ï¼Œæ¥ä¸€ä¸ªè¯·æ±‚äº‹ä»¶ï¼Œæ‰§è¡Œä¸€æ¬¡
         - å…ˆè·å–å½“å‰bucket , å†åˆ¤æ–­è¯·æ±‚çŠ¶æ€ï¼ŒæˆåŠŸçš„è¯ çœ‹è¦ä¸è¦åŠå¼€-å…³é—­ï¼Œå¤±è´¥æˆ–è€…è¶…æ—¶ï¼ŒåŠå¼€-å¼€å¯ã€‚
         - è¿™é‡Œä¸ç”¨å®³æ€• é”™è¯¯æŠŠæ–­è·¯å™¨æ‰“å¼€æˆ–è€…å…³é—­ï¼Œå› ä¸ºä»–åˆ¤æ–­äº†çŠ¶æ€æ˜¯åŠå¼€æ‰ä¼šæ‰§è¡Œã€‚
         - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646665329390-ffb7d50a-b2fb-47e1-b892-3035f26e54f8.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=172&id=u5099a538&margin=%5Bobject%20Object%5D&name=image.png&originHeight=592&originWidth=1396&originalType=binary&ratio=1&rotation=0&showTitle=false&size=319605&status=done&style=none&taskId=u031e6bb3-a228-4043-87bd-003080eed58&title=&width=405)
      - getCurrentBucket()
         - è¿™ä¸ªæ–¹æ³•é‡Œåœ¨è·å–å½“å‰bucketçš„æ—¶å€™ï¼Œæ‹¿bucketæˆ–è€…åˆ›å»ºæ–°çš„bucketï¼Œå¦‚æœæ˜¯æ–°å»ºbucketçš„æƒ…å†µå‘¢ï¼Œè¯´æ˜åˆ°äº†æˆ‘ä»¬éœ€è¦åˆ¤æ–­æ•´ä½“ç™¾åˆ†æ¯”çš„æƒ…å†µäº†ã€‚
         - æµç¨‹ï¼š
            - å¦‚æœæ—¶é—´è¿˜è½åœ¨å½“å‰æ¡¶ğŸª£å†…ï¼Œå°±ç”¨å½“å‰çš„ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±å‡†å¤‡åˆ›å»ºæ–°çš„ã€‚
            - åœ¨ç­‰å¾…å†™é”ğŸ”’æœŸé—´ï¼Œå¯èƒ½å…¶ä»–çº¿ç¨‹å·²ç»åˆ›å»ºäº†ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªdouble check
         - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646665616130-e7bc0b25-a97c-40e0-a9d7-02465d53ce7b.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=178&id=u2123ce3b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=680&originWidth=1386&originalType=binary&ratio=1&rotation=0&showTitle=false&size=344283&status=done&style=none&taskId=u642a551e-8d5b-4e6c-8db3-4aaa9756dd6&title=&width=363)
      - dealCreateBucketEvent()
         - è®¡ç®—æ•´ä½“ç™¾åˆ†æ¯”ï¼Œç„¶åtryMarkOpen(); è¿™ä¸ªæ–¹æ³•é‡Œå¦‚æœç™¾åˆ†æ¯”è¾¾åˆ°æ¯”ç‡ï¼Œå°±ä¼šå¼€å¯æ–­è·¯å™¨
         - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646665660157-a4401100-ffbd-4399-be1e-614813ad1a84.png#clientId=u0a012e60-c94a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=208&id=u5c6a2deb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=618&originWidth=896&originalType=binary&ratio=1&rotation=0&showTitle=false&size=158592&status=done&style=none&taskId=u6a3a4fa6-718e-4bc4-97e8-d4cf215c017&title=&width=301)

#### ä¸‰. é™çº§

1. å¯é™çº§æœåŠ¡
1. é™çº§æ–¹æ³• - é™çº§ä¹‹åæ‰§è¡Œå“ªä¸ªæ–¹æ³•ï¼Œæ¯”å¦‚å•†å“è®¡æ•°ä¸å¯ç”¨ï¼Œæˆ‘é™çº§ä¸ºå‡æ•°æ®æ˜¾ç¤ºæ€»æ•°
1. é™çº§è§¦å‘ï¼šç†”æ–­ä¹‹åçš„é™çº§ï¼Œè°ƒç”¨è¶…æ—¶å¼‚å¸¸
1. æ¢å¤

 

#### å››. Hystrix

- hystrix å‡ ç§ä»£ç ç”¨æ³•ï¼Œä»£ç ç»§æ‰¿
- hystrixæ³¨è§£ç”¨æ³•
- hystrixé…ç½®æ ¹æ® é…ç½®ä¸­å¿ƒé…ç½® åŠ¨æ€åˆ‡æ¢
   - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646756928766-50f17037-5909-479c-b95b-8880f8f3277c.png#clientId=u0dd75b0a-6bcc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=348&id=u17beea2d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=696&originWidth=1204&originalType=binary&ratio=1&rotation=0&showTitle=false&size=300547&status=done&style=none&taskId=uce086f63-8931-429b-933a-e78c63f127c&title=&width=602)
   - æ³¨è§£è¿›è¡Œå‚æ•°é…ç½®ï¼ŒexecuteCommandæ‰§è¡Œä»£ç ï¼Œï¼ŒCommandFallBackæ‰§è¡Œå¤±è´¥å›è°ƒé€»è¾‘
   - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22881482/1646756991423-75fce845-c64a-4a38-988c-4891cf643707.png#clientId=u0dd75b0a-6bcc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=398&id=u92200966&margin=%5Bobject%20Object%5D&name=image.png&originHeight=796&originWidth=990&originalType=binary&ratio=1&rotation=0&showTitle=false&size=290137&status=done&style=none&taskId=u82126d58-da4e-422b-bf2d-0a567f159f7&title=&width=495)
   - ä¸Šé¢æœ‰ä¸€ä¸ªå…³äº åŠ¨æ€ä¿®æ”¹æ³¨è§£å€¼çš„çŸ¥è¯†ç‚¹ï¼Œå¦‚ @XXX(value="")ï¼ŒProxy.getInvocationHandler(è¯¥æ³¨è§£å¯¹è±¡) è·å–æ³¨è§£åŠ¨æ€ä»£ç†å®é™…å¤„ç†handlerï¼Œ@XXXæ³¨è§£çš„å±æ€§éƒ½åœ¨è·å–åˆ°çš„mapé‡Œã€‚è¿™ä¸ªä½¿ç”¨å‚è€ƒï¼š
   -  `https://www.javabugs.com/article/68 `

